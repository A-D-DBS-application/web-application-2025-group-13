{% extends "base.html" %}

{% block content %}
<div class="my-group-container">
    
    <h1 class="my-group-h1">Mijn Reisgroep üåç</h1>

    {% if group_id %}
        <div class="group-card">
            <div class="group-header">
                <h2 style="margin: 0; color: #333;">Groep #{{ group_id }}</h2>
                <span class="group-member-count">
                    {{ members|length }} Leden
                </span>
            </div>

            {% if trip %}
                <div class="trip-assigned-box">
                    <div class="trip-assigned-content">
                        <div class="trip-details">
                            <div style="font-size: 2.5rem;">‚úàÔ∏è</div>
                            <div>
                                <h3 style="margin: 0 0 5px 0;">Jullie gaan naar: {{ trip.destination }}!</h3>
                                <p style="margin: 0;">
                                    üìÖ {{ trip.start_date }} t/m {{ trip.end_date }} <br>
                                    üí∞ ‚Ç¨{{ trip.price }} p.p.
                                </p>
                                
                                <a href="{{ url_for('export_group_calendar') }}" style="display: inline-block; margin-top: 10px; background-color: #f8f9fa; color: #333; padding: 6px 12px; border-radius: 20px; text-decoration: none; font-size: 0.85rem; border: 1px solid #ddd; font-weight: bold; transition: background 0.2s;">
                                    üìÖ Zet in mijn agenda
                                </a>

                            </div>
                        </div>
                        
                        <div class="trip-payment-area">
                            
                            {% set text_color = '#dc3545' if spots_left <= 3 else '#155724' %}
                            
                            <div class="spots-counter" style="color: {{ text_color }};">
                                Nog {{ spots_left }} plekken!
                            </div>

                            {% if my_entry.payment_status == 'paid' %}
                                <div class="paid-status">
                                    Betaald & bevestigd!
                                </div>
                                <div class="chat-info-box">
                                    ‚ÑπÔ∏è <strong>Chatten met je groep?</strong><br>
                                    Ongeveer 1 maand voor vertrek ontvang je hier een unieke code. Daarmee kun je in onze externe reis-app een groepschat starten om elkaar alvast te leren kennen!
                                </div>
                            {% else %}
                                {% if spots_left > 0 %}
                                    <form action="{{ url_for('pay_deposit') }}" method="POST">
                                        <button type="submit" class="pay-deposit-btn">
                                            üí≥ Betaal Voorschot (‚Ç¨{{ trip.deposit_amount }})
                                        </button>
                                    </form>
                                {% else %}
                                    <div class="full-status">
                                        ‚õî Volzet!
                                    </div>
                                {% endif %}
                            {% endif %}
                        </div>
                    </div>

                    {% if trip.description or trip.activities %}
                        <div class="trip-extra-info">
                            {% if trip.description %}
                                <h4 style="margin: 0 0 5px 0; color: #155724;">Over deze reis</h4>
                                <p style="margin: 0 0 15px 0; font-size: 0.95rem; white-space: pre-line;">{{ trip.description }}</p>
                            {% endif %}
                            
                            {% if trip.activities %}
                                <h4 style="margin: 0 0 5px 0; color: #155724;">Highlights & Activiteiten</h4>
                                <p style="margin: 0; font-size: 0.95rem; white-space: pre-line;">{{ trip.activities }}</p>
                            {% endif %}
                        </div>
                    {% endif %}
                </div>
            {% else %}
                <div class="no-trip-alert">
                    ‚è≥ De organisator heeft nog geen reis aan jullie groep gekoppeld. Even geduld!
                </div>
            {% endif %}

            <h3 style="color: #007B7F; margin-bottom: 15px;">Wie zitten er in je groep?</h3>
            <div class="members-grid">
                {% for member in members %}
                    <div class="member-card">
                        <div class="member-avatar">
                            {{ member.user.name[0] | upper }}
                        </div>
                        <div>
                            <div class="member-name">
                                {{ member.user.name }} 
                                {% if member.user.id == session['user_id'] %} (Jij) {% endif %}
                            </div>
                            <div class="member-age">{{ member.profile.age }} jaar</div>
                        </div>
                    </div>
                {% endfor %}
            </div>

            <div class="leave-group-section">
                <p style="color: #666; margin-bottom: 15px;">Niet blij met deze groep? Je kunt de groep verlaten en wachten op een nieuwe indeling.</p>
                <form action="{{ url_for('leave_group') }}" method="POST" onsubmit="return confirm('Weet je zeker dat je deze groep wilt verlaten?');">
                    <button type="submit" class="leave-group-btn">
                        Groep verlaten
                    </button>
                </form>
            </div>

        </div>
    {% else %}
        <div class="no-group-card">
            <div style="font-size: 4rem; margin-bottom: 20px;">ü§∑‚Äç‚ôÇÔ∏è</div>
            <h2 style="color: #333; margin-bottom: 10px;">Je zit nog niet in een groep</h2>
            
            {% if my_profile and not my_profile.is_active %}
                <div class="inactive-alert">
                    <strong>Je staat momenteel op "Pauze".</strong><br>
                    Je wordt niet meegenomen in nieuwe groepsvormingen.
                </div>
                <form action="{{ url_for('update_matching_status') }}" method="POST">
                    <input type="hidden" name="status" value="active">
                    <button type="submit" class="activate-btn">
                        üöÄ Zet mij weer op de lijst!
                    </button>
                </form>
            {% else %}
                <p style="color: #666; max-width: 500px; margin: 0 auto 30px auto;">
                    De organisator is druk bezig met puzzelen! Zodra de groepen zijn gemaakt, verschijnt jouw groep hier.
                </p>
                
                <div class="pause-section">
                    <p style="font-size: 0.9rem; color: #999;">Wil je even niet gematcht worden?</p>
                    <form action="{{ url_for('update_matching_status') }}" method="POST">
                        <input type="hidden" name="status" value="inactive">
                        <button type="submit" class="pause-btn">
                            Zet mij op pauze
                        </button>
                    </form>
                </div>
            {% endif %}
            
            <div style="margin-top: 40px;">
                <a href="{{ url_for('home') }}" style="color: #007B7F; font-weight: bold; text-decoration: none;">Terug naar Home</a>
            </div>
        </div>
    {% endif %}

</div>
{% endblock %}